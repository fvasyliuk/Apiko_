{"ast":null,"code":"import _createClass from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/wrapNativeSuper\";\nimport _objectSpread from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Apiko\\\\home_task_8\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\n\n/* global window */\nimport uuid from 'uuid/v4';\nvar methods = {\n  post: 'post',\n  get: 'get',\n  patch: 'patch',\n  delete: 'delete'\n};\n\nvar saveCache = function saveCache(cache) {\n  return window.localStorage.setItem('cache', JSON.stringify(cache));\n};\n\nvar getCache =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    var cache;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cache = window.localStorage.getItem('cache');\n\n            if (cache) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\", []);\n\n          case 3:\n            return _context.abrupt(\"return\", JSON.parse(cache));\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getCache() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction getRandomArbitrary(min, max) {\n  return Math.floor(Math.random() * (max - min) + min);\n}\n\nvar randomDelay = function randomDelay() {\n  return new Promise(function (res) {\n    var delay = getRandomArbitrary(200, 2000);\n    setTimeout(res, delay);\n  });\n};\n\nvar getId = function getId(endpoint) {\n  return endpoint.split('/')[1];\n};\n\nvar handleRequest =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(endpoint, options, cache) {\n    var _newCache, timestamp, newTodo, newCache, id, _newTodo, _newCache2, _id, _newCache3;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (options.body) {\n              options.body = JSON.parse(options.body); // eslint-disable-line no-param-reassign\n            }\n\n            _context2.t0 = options.method;\n            _context2.next = _context2.t0 === methods.get ? 4 : _context2.t0 === methods.post ? 5 : _context2.t0 === methods.patch ? 16 : _context2.t0 === methods.delete ? 21 : 26;\n            break;\n\n          case 4:\n            return _context2.abrupt(\"return\", cache);\n\n          case 5:\n            if (!(endpoint === 'todos/remove')) {\n              _context2.next = 10;\n              break;\n            }\n\n            _newCache = cache.filter(function (todo) {\n              return !options.body.includes(todo.id);\n            });\n            _context2.next = 9;\n            return saveCache(_newCache);\n\n          case 9:\n            return _context2.abrupt(\"return\", {\n              success: true\n            });\n\n          case 10:\n            timestamp = new Date().getTime();\n            newTodo = _objectSpread({}, options.body, {\n              id: uuid(),\n              createdAt: timestamp,\n              updatedAt: timestamp\n            });\n            newCache = cache.concat(newTodo);\n            _context2.next = 15;\n            return saveCache(newCache);\n\n          case 15:\n            return _context2.abrupt(\"return\", newTodo);\n\n          case 16:\n            id = getId(endpoint);\n            _newCache2 = cache.map(function (todo) {\n              if (todo.id !== id) {\n                return todo;\n              }\n\n              _newTodo = _objectSpread({}, todo, options.body, {\n                updatedAt: new Date().getTime()\n              });\n              return _newTodo;\n            });\n            _context2.next = 20;\n            return saveCache(_newCache2);\n\n          case 20:\n            return _context2.abrupt(\"return\", _newTodo);\n\n          case 21:\n            _id = getId(endpoint);\n            _newCache3 = cache.filter(function (todo) {\n              return todo.id !== _id;\n            });\n            _context2.next = 25;\n            return saveCache(_newCache3);\n\n          case 25:\n            return _context2.abrupt(\"return\", {\n              success: true\n            });\n\n          case 26:\n            return _context2.abrupt(\"return\", cache);\n\n          case 27:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function handleRequest(_x, _x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport var AbortError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(AbortError, _Error);\n\n  function AbortError() {\n    var _this;\n\n    _classCallCheck(this, AbortError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AbortError).call(this));\n    _this.name = 'AbortError';\n    _this.message = 'Request was aborted.';\n    _this.stack = new Error().stack;\n    return _this;\n  }\n\n  return AbortError;\n}(_wrapNativeSuper(Error));\n\nvar EventEmitter =\n/*#__PURE__*/\nfunction () {\n  function EventEmitter() {\n    _classCallCheck(this, EventEmitter);\n\n    this.listener = null;\n  }\n\n  _createClass(EventEmitter, [{\n    key: \"send\",\n    value: function send() {\n      this.listener();\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(cb) {\n      this.listener = cb;\n    }\n  }]);\n\n  return EventEmitter;\n}();\n\nexport function createAbortSignal() {\n  var abortEvent = new EventEmitter();\n\n  function abort() {\n    abortEvent.send();\n  }\n\n  function signal() {\n    abortEvent.subscribe(function () {\n      throw new AbortError();\n    });\n  }\n\n  signal.abort = abort;\n  return signal;\n}\n\nvar fetchData =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(endpoint) {\n    var options,\n        cache,\n        res,\n        _args3 = arguments;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            options = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {};\n\n            if (options.signal) {\n              options.signal();\n            }\n\n            if (!options.method) {\n              options.method = methods.get; // eslint-disable-line no-param-reassign\n            }\n\n            if (options.body) {\n              options.body = JSON.stringify(options.body); // eslint-disable-line no-param-reassign\n            } // getting cached data from store\n\n\n            _context3.next = 6;\n            return getCache();\n\n          case 6:\n            cache = _context3.sent;\n            _context3.next = 9;\n            return handleRequest(endpoint, options, cache);\n\n          case 9:\n            res = _context3.sent;\n            _context3.next = 12;\n            return randomDelay();\n\n          case 12:\n            return _context3.abrupt(\"return\", res);\n\n          case 13:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function fetchData(_x4) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexport default fetchData;","map":{"version":3,"sources":["C:\\Apiko\\home_task_8\\src\\api\\Backend.js"],"names":["uuid","methods","post","get","patch","delete","saveCache","cache","window","localStorage","setItem","JSON","stringify","getCache","getItem","parse","getRandomArbitrary","min","max","Math","floor","random","randomDelay","Promise","res","delay","setTimeout","getId","endpoint","split","handleRequest","options","body","method","newCache","filter","todo","includes","id","success","timestamp","Date","getTime","newTodo","createdAt","updatedAt","concat","map","AbortError","name","message","stack","Error","EventEmitter","listener","cb","createAbortSignal","abortEvent","abort","send","signal","subscribe","fetchData"],"mappings":"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","sourcesContent":["/* global window */\nimport uuid from 'uuid/v4';\n\nconst methods = {\n  post: 'post',\n  get: 'get',\n  patch: 'patch',\n  delete: 'delete',\n};\n\nconst saveCache = (cache) =>\n  window.localStorage.setItem('cache', JSON.stringify(cache));\n\nconst getCache = async () => {\n  const cache = window.localStorage.getItem('cache');\n\n  if (!cache) {\n    return [];\n  }\n\n  return JSON.parse(cache);\n};\n\nfunction getRandomArbitrary(min, max) {\n  return Math.floor(Math.random() * (max - min) + min);\n}\n\nconst randomDelay = () =>\n  new Promise((res) => {\n    const delay = getRandomArbitrary(200, 2000);\n\n    setTimeout(res, delay);\n  });\n\nconst getId = (endpoint) => endpoint.split('/')[1];\n\nconst handleRequest = async (endpoint, options, cache) => {\n  if (options.body) {\n    options.body = JSON.parse(options.body); // eslint-disable-line no-param-reassign\n  }\n\n  switch (options.method) {\n    case methods.get: {\n      return cache;\n    }\n\n    case methods.post: {\n      if (endpoint === 'todos/remove') {\n        const newCache = cache.filter(\n          (todo) => !options.body.includes(todo.id),\n        );\n\n        await saveCache(newCache);\n\n        return { success: true };\n      }\n\n      const timestamp = new Date().getTime();\n      const newTodo = {\n        ...options.body,\n        id: uuid(),\n        createdAt: timestamp,\n        updatedAt: timestamp,\n      };\n      const newCache = cache.concat(newTodo);\n\n      await saveCache(newCache);\n\n      return newTodo;\n    }\n\n    case methods.patch: {\n      const id = getId(endpoint);\n\n      let newTodo;\n\n      const newCache = cache.map((todo) => {\n        if (todo.id !== id) {\n          return todo;\n        }\n\n        newTodo = {\n          ...todo,\n          ...options.body,\n          updatedAt: new Date().getTime(),\n        };\n\n        return newTodo;\n      });\n\n      await saveCache(newCache);\n\n      return newTodo;\n    }\n\n    case methods.delete: {\n      const id = getId(endpoint);\n\n      const newCache = cache.filter((todo) => todo.id !== id);\n\n      await saveCache(newCache);\n\n      return { success: true };\n    }\n\n    default:\n      return cache;\n  }\n};\n\nexport class AbortError extends Error {\n  constructor() {\n    super();\n    this.name = 'AbortError';\n    this.message = 'Request was aborted.';\n    this.stack = new Error().stack;\n  }\n}\n\nclass EventEmitter {\n  constructor() {\n    this.listener = null;\n  }\n\n  send() {\n    this.listener();\n  }\n\n  subscribe(cb) {\n    this.listener = cb;\n  }\n}\n\nexport function createAbortSignal() {\n  const abortEvent = new EventEmitter();\n\n  function abort() {\n    abortEvent.send();\n  }\n\n  function signal() {\n    abortEvent.subscribe(() => {\n      throw new AbortError();\n    });\n  }\n\n  signal.abort = abort;\n\n  return signal;\n}\n\nconst fetchData = async (endpoint, options = {}) => {\n  if (options.signal) {\n    options.signal();\n  }\n\n  if (!options.method) {\n    options.method = methods.get; // eslint-disable-line no-param-reassign\n  }\n\n  if (options.body) {\n    options.body = JSON.stringify(options.body); // eslint-disable-line no-param-reassign\n  }\n\n  // getting cached data from store\n  const cache = await getCache();\n\n  const res = await handleRequest(endpoint, options, cache);\n\n  await randomDelay();\n\n  return res;\n};\n\nexport default fetchData;\n"]},"metadata":{},"sourceType":"module"}